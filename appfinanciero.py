# -*- coding: utf-8 -*-
"""AppFinanciero.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1jHTVGFmeRVzpFSpQwkzQsxgy8nkvdL2e
"""

# Proyecto: APP Financiero
# Desarrollado por: Alejandro Ca√±as, Emmanuel Garc√≠a, Maricielo G√≥mez
# Descripci√≥n: App que determina el perfil del inversor y analiza acciones con Python.

pip install streamlit yfinance

pip install streamlit-option-menu

# Importar librerias ----
import streamlit as st #Interfaz intercativo
import pandas as pd #Manejo de dataframes
import numpy as np #Soporte de c√°lculo matem√°ticos y matrices
import yfinance as yf #Datos financieros de Yahoo Finance
import matplotlib.pyplot as plt #Gr√°ficos y visualizaciones de datos
import datetime #Manejo de fechas
from streamlit_option_menu import option_menu

# Inicializar variable de sesi√≥n ---
if "perfil" not in st.session_state:
    st.session_state.perfil = None

# Crear men√∫ lateral
with st.sidebar:
    seleccion = option_menu(
        "APP Financiero",
        ["Inicio", "Perfil de inversor", "Simulaci√≥n de portafolio - Una acci√≥n", "Simulaci√≥n de portafolio - Dos o m√°s acciones", "Referencias"],
        icons=["house", "graph-up", "bar-chart", "gear"],
        menu_icon="cast",
        default_index=0,
        orientation="vertical",
    )

# Contenido din√°mico
if seleccion == "Inicio":
    st.title("üè† Bienvenido a nuestra APP")
    st.header("‚ú® Tu estilo, tu riesgo, tu inversi√≥n.")
    st.markdown("""
    Esta app te ayuda a identificar tu *perfil de inversor* y analizar el comportamiento de acciones reales.""")
    st.markdown("Elige tus preferencias y descubre c√≥mo se ajustan a los distintos tipos de portafolio.")
    st.markdown("*Desarrollado por: Alejandro Ca√±as, Emmanuel Garc√≠a, Maricielo G√≥mez*")

elif seleccion == "Perfil de inversor":

    # üß≠ CUESTIONARIO DE PERFIL
    st.title("üß© Cuestionario del inversor")
    st.header("üë§ Descubre tu perfil de inversor")
    st.markdown("Responde las siguientes preguntas para determinar tu tolerancia al riesgo, horizonte y conocimiento.")
    st.markdown("---")

    puntaje_total = 0

    st.subheader("I. Tolerancia al riesgo (Tu Reacci√≥n a la volatilidad)")

    # Pregunta 1: Reacci√≥n a la P√©rdida
    q1 = st.radio(
        "1. Si su portafolio cayera un 20% en un mes, usted...",
        ('A) Vender√≠a inmediatamente, no tolero m√°s p√©rdidas. (1 punto)',
        'B) Mantendr√≠a la inversi√≥n, esperando la recuperaci√≥n. (3 puntos)',
        'C) Invertir√≠a m√°s para aprovechar los precios bajos. (5 puntos)'),
        index=None  # Sin selecci√≥n por defecto
    )
    if q1:
        puntaje_total += int(q1.split('(')[-1].split()[0])

    # Pregunta 2: Prioridad de inversi√≥n
    q2 = st.radio(
    "2. ¬øQu√© es m√°s importante para usted?",
    ('A) Preservar el capital y obtener un retorno bajo pero seguro. (1 punto)',
    'B) Equilibrio entre crecimiento y seguridad. (3 puntos)',
    'C) M√°ximo rendimiento, aceptando un riesgo significativo. (5 puntos)'),
    index=None
    )
    if q2:
        puntaje_total += int(q2.split('(')[-1].split()[0])

    # Pregunta 3: Volatilidad Aceptable
    q3 = st.radio(
        "3. ¬øQu√© porcentaje de ca√≠da est√° dispuesto a aceptar en su capital en un a√±o?",
        ('A) Menos del 5%. (1 punto)',
        'B) Entre 10% y 20%. (3 puntos)',
        'C) M√°s del 25%. (5 puntos)'),
        index=None
    )
    if q3:
        puntaje_total += int(q3.split('(')[-1].split()[0])

    st.markdown("---")

    # --- SECCI√ìN II: HORIZONTE DE INVERSI√ìN (2 Preguntas) ---
    st.subheader("II. Horizonte de Inversi√≥n (Plazo)")

    # Pregunta 4: Mayor Objetivo
    q4 = st.radio(
    "4. ¬øPara qu√© objetivo principal est√° destinando este dinero?",
    ('A) Necesidades a corto plazo (1-3 a√±os). (1 punto)',
    'B) Mediano plazo (3-7 a√±os). (3 puntos)',
    'C) Largo plazo/Jubilaci√≥n (m√°s de 7 a√±os). (5 puntos)'),
    index=None
    )
    if q4:
        puntaje_total += int(q4.split('(')[-1].split()[0])

    # Pregunta 5: Momento de Retiro
    q5 = st.radio(
    "5. ¬øEn cu√°ntos a√±os planea retirar la mayor parte de este capital?",
    ('A) Menos de 2 a√±os. (1 punto)',
    'B) 5 a 10 a√±os. (3 puntos)',
    'C) M√°s de 15 a√±os. (5 puntos)'),
    index=None
    )
    if q5:
        puntaje_total += int(q5.split('(')[-1].split()[0])

    st.markdown("---")

    # --- SECCI√ìN III: CONOCIMIENTO Y EXPERIENCIA (2 Preguntas) ---
    st.subheader("III. Conocimiento y Experiencia")

    # Pregunta 6: Familiaridad con M√©tricas
    q6 = st.radio(
    "6. ¬øQu√© tan familiarizado est√° con el Ratio de Sharpe o el Modelo CAPM?",
    ('A) Nada familiarizado. (1 punto)',
    'B) Entiendo los conceptos b√°sicos. (3 puntos)',
    'C) Los uso frecuentemente en mi an√°lisis. (5 puntos)'),
    index=None
    )
    if q6:
        puntaje_total += int(q6.split('(')[-1].split()[0])

    # Pregunta 7: Experiencia con Instrumentos
    q7 = st.radio(
    "7. ¬øEn qu√© tipos de activos ha invertido o analizado con frecuencia?",
    ('A) Solo Cuentas de Ahorro, Dep√≥sitos (CDTs) y Fondos de inversi√≥n colectiva. (1 punto)',
      'B) Acciones individuales (AAPL, MSFT) y Bonos. Entiendo la diversificaci√≥n. (3 puntos)',
      'C) Futuros, Opciones, Criptomonedas, o he usado Apalancamiento/Venta en Corto. (5 puntos)'),
    index=None
    )
    if q7:
        puntaje_total += int(q7.split('(')[-1].split()[0])

    st.markdown("---")

        # --- BOT√ìN Y C√ÅLCULO FINAL ---

    # Se verifica que todas las preguntas hayan sido respondidas antes de permitir el c√°lculo
    preguntas_respondidas = all([q1, q2, q3, q4, q5, q6, q7])

    if st.button("Calcular mi Perfil de Inversor"):
        if preguntas_respondidas:

            st.subheader("üéâ Resultado de tu Perfil de Inversor")
            st.metric("Puntuaci√≥n Total", puntaje_total)

            # L√≥gica de Clasificaci√≥n del Perfil (Basada en 7-35 puntos)
            if puntaje_total <= 15:
                perfil = "Conservador (Preservaci√≥n del Capital)üõ°Ô∏è"
                st.success(f"Tu perfil es: **{perfil}**")
                st.write("Tu prioridad es la seguridad. Se recomienda invertir en activos de Renta Fija y baja volatilidad.")
                st.session_state.perfil = "CONSERVADOR" # Initialize session state

            elif puntaje_total <= 25:
                perfil = "Moderado / Equilibrado (Crecimiento y Estabilidad) üåø"
                st.info(f"Tu perfil es: **{perfil}**")
                st.write("Buscas un balance. Se recomienda una cartera diversificada que combine renta fija y renta variable (Modelo Markowitz).")
                st.session_state.perfil = "MODERADO" # Initialize session state

            else: # puntaje_total > 25
                perfil = "Arriesgado / Crecimiento (M√°ximo Rendimiento) üî•"
                st.warning(f"Tu perfil es: **{perfil}**")
                st.write("Tienes una alta tolerancia al riesgo y conocimiento. Se recomienda enfocarse en la eficiencia del portafolio (Ratio de Sharpe).")
                st.session_state.perfil = "ARRIESGADO" # Initialize session state

        else:
            st.error("Por favor, responde todas las preguntas para obtener tu resultado.")

elif seleccion == "Resultados":
    st.header("üìà Resultados del an√°lisis")

elif seleccion == "Configuraci√≥n":
    st.header("‚öôÔ∏è Configuraci√≥n de usuario")